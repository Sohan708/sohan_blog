<%- include('../partials/header') %>

<section class="card filter-card">
  <form class="form-grid" method="get" action="/blog">
    <input class="field" type="text" name="q" placeholder="Search" value="<%= q %>" />
    <select class="field" name="category">
      <option value="">All categories</option>
      <% categories.forEach(function(cat) { %>
        <option value="<%= cat.slug %>" <%= category && category.slug === cat.slug ? 'selected' : '' %>><%= cat.name %></option>
      <% }) %>
    </select>
    <input class="field" type="text" name="tag" placeholder="Tag" value="<%= tag %>" />
    <button class="btn btn-primary" type="submit">Filter</button>
  </form>
</section>

<section class="post-grid">
  <% posts.forEach(function(post) { %>
    <article class="card post-card">
      <% if (post.coverImagePath) { %>
        <img class="post-cover" src="<%= post.coverImagePath %>" alt="<%= post.title %>" />
      <% } %>
      <p class="meta"><%= formatDate(post.publishedAt || post.createdAt) %> ÅE <%= estimateReadTime(post.content) %></p>
      <h3 class="title-md"><a href="/blog/<%= post.slug %>"><%= post.title %></a></h3>
      <p class="muted"><%= post.excerpt %></p>
      <div class="tag-row">
        <span class="tag"><%= post.category?.name || 'General' %></span>
        <% post.tags.forEach(function(tag) { %>
          <a class="tag" href="/tag/<%= encodeURIComponent(tag) %>">#<%= tag %></a>
        <% }) %>
      </div>
    </article>
  <% }) %>
</section>

<% if (!posts.length) { %>
  <p class="muted">No posts found.</p>
<% } %>

<div class="pager">
  <% if (page > 1) { %>
    <a class="btn btn-outline" href="/blog?page=<%= page - 1 %>&q=<%= q %>&category=<%= category ? category.slug : '' %>&tag=<%= tag %>">Previous</a>
  <% } else { %>
    <span></span>
  <% } %>
  <% if (page < totalPages) { %>
    <a class="btn btn-outline" href="/blog?page=<%= page + 1 %>&q=<%= q %>&category=<%= category ? category.slug : '' %>&tag=<%= tag %>">Next</a>
  <% } %>
</div>

<%- include('../partials/footer') %>

<%- include('../partials/header') %>

<div class="admin-layout">
  <%- include('../partials/admin-nav') %>
  <section class="admin-panel">
    <div class="section-head">
      <div>
        <p class="eyebrow">Editor</p>
        <h1 class="section-title"><%= post ? 'Edit post' : 'New post' %></h1>
      </div>
    </div>
    <% if (errors.length) { %>
      <div class="alert">
        <ul>
          <% errors.forEach(function(error) { %>
            <li><%= error %></li>
          <% }) %>
        </ul>
      </div>
    <% } %>
    <form class="form-stack" method="post" enctype="multipart/form-data" action="<%= post && post._id ? '/admin/posts/' + post._id : '/admin/posts' %>">
      <input class="field" type="text" name="title" placeholder="Title" value="<%= post?.title || '' %>" required />
      <input class="field" type="text" name="slug" placeholder="Slug (auto if blank)" value="<%= post?.slug || '' %>" />
      <textarea class="field textarea" name="excerpt" rows="2" placeholder="Excerpt" required><%= post?.excerpt || '' %></textarea>
      <textarea class="field textarea is-hidden" id="content" name="content" rows="12" placeholder="Content"><%- post?.content || '' %></textarea>
      <div class="editor-shell">
        <div id="editor"></div>
      </div>
      <select class="field" name="category" required>
        <option value="">Select category</option>
        <% categories.forEach(function(cat) { %>
          <option value="<%= cat._id %>" <%= post?.category && cat._id.toString() === post.category.toString() ? 'selected' : '' %>><%= cat.name %></option>
        <% }) %>
      </select>
      <input class="field" type="text" name="tags" placeholder="Tags (comma-separated)" value="<%= Array.isArray(post?.tags) ? post.tags.join(', ') : (post?.tags || '') %>" />
      <div class="form-grid">
        <select class="field" name="status">
          <option value="draft" <%= post?.status === 'draft' ? 'selected' : '' %>>Draft</option>
          <option value="published" <%= post?.status === 'published' ? 'selected' : '' %>>Published</option>
        </select>
        <input class="field" type="datetime-local" name="scheduledAt" value="<%= post?.scheduledAt ? new Date(post.scheduledAt).toISOString().slice(0,16) : '' %>" />
      </div>
      <input class="field" type="text" name="metaTitle" placeholder="Meta title" value="<%= post?.metaTitle || '' %>" />
      <textarea class="field textarea" name="metaDescription" rows="2" placeholder="Meta description"><%= post?.metaDescription || '' %></textarea>
      <div class="upload-block">
        <label class="meta">Cover image</label>
        <input class="file" type="file" name="coverImage" accept="image/*" />
        <% if (post?.coverImagePath) { %>
          <img class="thumb" src="<%= post.coverImagePath %>" alt="Cover image" />
        <% } %>
      </div>
      <p class="meta">Scheduled posts will publish automatically and trigger the webhook.</p>
      <button class="btn btn-primary" type="submit">Save</button>
    </form>
  </section>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css" />
<script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>
<script src="/scripts/editor.js"></script>

<%- include('../partials/footer') %>



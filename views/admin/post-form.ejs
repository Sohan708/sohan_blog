<%- include('../partials/header') %>

<div class="grid gap-6 lg:grid-cols-[280px_1fr]">
  <%- include('../partials/admin-nav') %>
  <section>
    <h1 class="text-2xl font-semibold"><%= post ? 'Edit post' : 'New post' %></h1>
    <% if (errors.length) { %>
      <div class="mt-4 rounded-xl border border-red-500/40 bg-red-500/10 p-4 text-sm text-red-200">
        <ul>
          <% errors.forEach(function(error) { %>
            <li><%= error %></li>
          <% }) %>
        </ul>
      </div>
    <% } %>
    <form class="mt-6 grid gap-4" method="post" enctype="multipart/form-data" action="<%= post && post._id ? '/admin/posts/' + post._id : '/admin/posts' %>">
      <input class="rounded-xl border border-slate-700 bg-slate-950 px-4 py-2 text-sm" type="text" name="title" placeholder="Title" value="<%= post?.title || '' %>" required />
      <input class="rounded-xl border border-slate-700 bg-slate-950 px-4 py-2 text-sm" type="text" name="slug" placeholder="Slug (auto if blank)" value="<%= post?.slug || '' %>" />
      <textarea class="rounded-xl border border-slate-700 bg-slate-950 px-4 py-2 text-sm" name="excerpt" rows="2" placeholder="Excerpt" required><%= post?.excerpt || '' %></textarea>
      <textarea class="rounded-xl border border-slate-700 bg-slate-950 px-4 py-2 text-sm" name="content" rows="8" placeholder="Content" required><%= post?.content || '' %></textarea>
      <select class="rounded-xl border border-slate-700 bg-slate-950 px-4 py-2 text-sm" name="category" required>
        <option value="">Select category</option>
        <% categories.forEach(function(cat) { %>
          <option value="<%= cat._id %>" <%= post?.category && cat._id.toString() === post.category.toString() ? 'selected' : '' %>><%= cat.name %></option>
        <% }) %>
      </select>
      <input class="rounded-xl border border-slate-700 bg-slate-950 px-4 py-2 text-sm" type="text" name="tags" placeholder="Tags (comma-separated)" value="<%= post?.tags ? post.tags.join(', ') : '' %>" />
      <div class="grid gap-4 md:grid-cols-2">
        <select class="rounded-xl border border-slate-700 bg-slate-950 px-4 py-2 text-sm" name="status">
          <option value="draft" <%= post?.status === 'draft' ? 'selected' : '' %>>Draft</option>
          <option value="published" <%= post?.status === 'published' ? 'selected' : '' %>>Published</option>
        </select>
        <input class="rounded-xl border border-slate-700 bg-slate-950 px-4 py-2 text-sm" type="datetime-local" name="scheduledAt" value="<%= post?.scheduledAt ? post.scheduledAt.toISOString().slice(0,16) : '' %>" />
      </div>
      <input class="rounded-xl border border-slate-700 bg-slate-950 px-4 py-2 text-sm" type="text" name="metaTitle" placeholder="Meta title" value="<%= post?.metaTitle || '' %>" />
      <textarea class="rounded-xl border border-slate-700 bg-slate-950 px-4 py-2 text-sm" name="metaDescription" rows="2" placeholder="Meta description"><%= post?.metaDescription || '' %></textarea>
      <div>
        <label class="text-sm text-slate-300">Cover image</label>
        <input class="mt-2 block w-full text-sm" type="file" name="coverImage" accept="image/*" />
        <% if (post?.coverImagePath) { %>
          <img class="mt-3 h-32 rounded-xl object-cover" src="<%= post.coverImagePath %>" alt="Cover image" />
        <% } %>
      </div>
      <p class="text-xs text-slate-400">Scheduled posts will publish automatically and trigger the webhook.</p>
      <button class="rounded-xl bg-white px-4 py-2 text-sm font-semibold text-slate-900" type="submit">Save</button>
    </form>
  </section>
</div>

<%- include('../partials/footer') %>

